{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="container-fluid">
        <div class="row">
            <div class="col text-center mt-3">
                <h2 class="logo-font">Plans</h2>
                <!--Trying to slot in buttons for techniques...used name not friendly name as no friendly_name for techniques
                on admin interface-->
                {% for c in current_techniques %}
                    <a class="technique-badge text-decoration-none" href="{% url 'plans' %}?technique={{ c.name }}">
                        <span class="p-2 mt-2 badge badge-white text-black rounded-0 border border-dark">{{ c.Name }}</span>
                    </a>
                {% endfor %}
                        <!--occupation-badge css class for styling-ensure corresponding css class is updated-->
                    <hr class="w-50 mb-1">
                <hr class="w-50 mb-1">
            </div>
        </div>
        <!-- row to contain page title and any currently selected categories-->
        <div class="row">
            <div class="plan-container col-10 offset-1"></div>
            <div class="row mt-1 mb-2">
                 <!-- Layout of two columns, this layout puts sort select box on top on mobile but using order-first and order-last classes, adjusts it so
                sort select box will be last column on medium and larger screens(laptops, pcs) Moving to sort select, standard select box, determine selected value
                check value of current sorting template variable. Returning from view, none_none if no sorting selected. if value is
            price_ascending, this option selected in box...javascript to be written later-->
                <div class="col-12 col-md-6 my-auto order-md-last d-flex justify-content-center justify-content-md-end">
                    <div class="sort-select-wrapper w-50">
                        <select id="sort-selector" class="custom-select custom-select-sm rounded-0 border border-{% if current_sorting != 'None_None' %}info{% else %}black{% endif %}">
                            <option value="reset" {% if current_sorting == 'None_None' %}selected{% endif %}>Sort by...</option>
                            <option value="price_asc" {% if current_sorting == 'price_asc' %}selected{% endif %}>Price (low to high)</option>
                            <option value="price_desc" {% if current_sorting == 'price_desc' %}selected{% endif %}>Price (high to low)</option>
                            <!--option value="rating_asc" {% if current_sorting == 'rating_asc' %}selected{% endif %}-->Level (low to high)</option> <!--level cannot be high to low as it is not numeric, can't be alphabetic, how do I make it Beginner, Intermediate, Advanced...custom?-->
                            <option value="occupation_asc" {% if current_sorting == 'occupation_asc' %}selected{% endif %}>Occupation (A-Z)</option> <!--delete name as occupation and name more or less the same-->
                            <option value="occupation_desc" {% if current_sorting == 'occupation_desc' %}selected{% endif %}>Occupation (Z-A)</option>
                        </select>
                    </div>
                </div>
                <!--plan count and search results. three parts. using length to count plans, if search term returned in context
                from all_plans, tack on words waht was searched for, in front of plans, link to go to main plans page-->
                <div class="col-12 col-md-6 order-md-first">
                    <p class="text-muted mt-3 text-center text-md-left">
                        {% if search_term or current_occupations or current_sorting != 'None_None' %}
                            <span class="small"><a href="{% url 'plans' %}">Plans Home</a> | </span>
                        {% endif %}
                        {{ plans|length }} Plans{% if search_term %} found for <strong>"{{ search_term }}"</strong>{% endif %}
                    </p>
                </div>
            </div>
            <div class="row">
                {% for plan in plans %}
                    <div class="col-sm-6 col-md-6 col-lg-4 col-xl-3">
                        <div class="card h-100 border-0">
                            {% if plan.image %}
                                <a href="{% url 'plan_detail' plan.id %}">
                                    <img class="card-img-top img-fluid" src="{{ plan.image.url }}" alt="{{ plan.name }}">
                                </a>
                                {% else %}
                                <a href="{% url 'plan_detail' plan.id %}">
                                    <img class="card-img-top img-fluid" src="{{ MEDIA_URL }}noimage.png" alt="{{ plan.name }}">
                                </a>
                                {% endif %}
                                <div class="card-body pb-0">
                                    <p class="mb-0">{{ plan.name }}</p>
                                </div>
                                <div class="card-footer bg-white pt-0 border-0 text-left">
                                    <div class="row">
                                        <div class="col">
                                            <p class="lead mb-0 text-left font-weight-bold">â‚¬{{ plan.price }}</p>
                                            <!-- to display occupation on card includes a link also...link if you click on, filters only that occupation-->
                                            {% if plan.occupation %}
                                            <p class="small mt-1 mb-0">
                                                <a class="text-muted" href="{% url 'plans' %}?occupation={{ plan.occupation.name }}">
                                                    <i class="fa-solid fa-certificate mr-1"></i>{{ plan.occupation.friendly_name }}
                                                </a>
                                            </p>
                                            {% endif %}
                                             <!-- to display level and wreath on card-->
                                            {% if plan.level %}
                                                <small class="text-muted"><i class="fa-solid fa-medal mr-1"></i>{{ plan.level }}</small>
                                            {% else %}
                                                <small class="text-muted">No level specified</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                            <p class="lead mb-0 text-left font-weight-bold"></p>
                                            <!-- to display goal and bullseye on card-->
                                            {% if plan.goal %}
                                                <small class="text-muted"><i class="fa-solid fa-bullseye mr-1"></i>{{ plan.goal }}</small>
                                            {% else %}
                                                <small class="text-muted">No goal specified</small>
                                            {% endif %}
                                            <!-- to display goal and icon on card-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <!-- code for card comes from Bootsrap docs-->
                    {% if forloop.counter|divisibleby:1 %}
                    <div class="col-12 d-sm-none mb-5">
                        <!-- to be explicit but not needed as counter always divisible by 1 mb=bottom margin-->
                        <hr>
                    </div>
                {% endif %}                        
                {% if forloop.counter|divisibleby:2 %}
                    <div class="col-12 d-none d-sm-block d-md-block d-lg-none mb-5">
                        <!-- hidden on large and up-->
                        <hr>
                    </div>
                {% endif %}
                {% if forloop.counter|divisibleby:3 %}
                    <div class="col-12 d-none d-lg-block d-xl-none mb-5">
                        <!-- hidden on everything but large-->
                        <hr>
                    </div>
                {% endif %}
                {% if forloop.counter|divisibleby:4 %}
                    <div class="col-12 d-none d-xl-block mb-5">
                        <hr>
                    </div>
                {% endif %}
            {% endfor%}-->
        </div>
    </div>
</div>
</div>
<!--useful scroll to top button-->
<div class="btt-button shadow-sm rounded-0 border border-black">
<a class="btt-link d-flex h-100">
    <i class="fas fa-arrow-up text-black mx-auto my-auto"></i>
</a>	
</div>
{% endblock %}
{% block postloadjs %} <!--wrapped inside postloadjs block from template-->
    {{ block.super }} <!--using block.super will ensure we append code to anything already in block -->
    <script type="text/javascript">
        $('.btt-link').click(function(e) {
            window.scrollTo(0,0)
          })
    </script><!--javascript for back to top button -->
    <script type="text/javascript">
        $('#sort-selector').change(function(){ //capture change event from sort-selector itself
            var selector = $(this) //variable for selector
    
            var currentUrl = new URL(window.location); //variable for current url=new url object that considers current window's location
            //ability to replace current get parameters to update sorting methodology

            var selectVal = selector.val(); //this value refers to value attribute from selected option element in selector box 
            if (selectedVal != "reset"){ //need if statement to determine if selected value is reset to default from plans page
                var sort = selectedVal.split("_")[0]//if not get sort and direction by splitting selected value at underscore
                var direction = selectedVal.split("_")[1]; //first item of split item we are sorting on and second will be direction 
                //either ascending or descending...indexation

                currentUrl.searchParams.set("sort", sort); //replace GET parameters in URL using searchParams.set method from the URL object
                currentUrl.searchParams.set("direction", direction);

                window.location.replace(currentUrl);  //with new URL constructed, replace current location using window.location.replace
                } else {                                //with the updated current URL. Replacing location also causes page to reload, resorting plans accordingly
                    currentUrl.searchParams.delete("sort"); //else if the user has selected the reset option, DELETE sort and direction parameters and replace location
                    currentUrl.searchParams.delete("direction");

                    window.location.replace(currentUrl); 
            }})
    </script>
{% endblock %}

